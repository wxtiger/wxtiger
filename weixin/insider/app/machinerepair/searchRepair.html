<!doctype html>
<html>
<head>
    <meta charset="UTF-8">  
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>报修列表</title>  
	<link rel="stylesheet" type="text/css" href="/weixin/system/js/easyui/themes/bootstrap/easyui.css">
	<link rel="stylesheet" type="text/css" href="/weixin/system/js/easyui/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="/weixin/system/js/easyui/themes/color.css">
	<link rel="stylesheet" type="text/css" href="/weixin/system/js/easyui/themes/mobile.css">
	<link rel="stylesheet" type="text/css" href="/weixin/system/js/easyui/themes/body.css">
	
	<script type="text/javascript" src="/weixin/system/js/easyui/jquery.min.js"></script>
	<script type="text/javascript" src="/weixin/system/js/easyui/jquery.easyui.min.js"></script>	
	<script type="text/javascript" src="/weixin/system/js/easyui/jquery.easyui.mobile.js"></script> 
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>
	<script src="/weixin/system/js/weixin.tools.js"></script>
	
	<script src="search.js?aaa=007&"></script>
	
</head>
<body>

<div style="display:none">

	<input type="text" id="idCurWXID" value="" >	
	<input type="text" id="idUserName" value="" />
	<input type="text" id="idUserMobile" value="" />	
	<input type="text" id="idNumFrom" value="" />	
	<input type="text" id="idSearchClass" value="01" />	

</div>


    <div class="easyui-navpanel">
        <header>
            <div class="m-toolbar" >
                <span id="idMsgShow" class="m-title">请选择右边菜单</span>
            </div>
			<div class="m-left" style="display:;margin-left:10px;">
                    <a href="main.html" class="easyui-linkbutton" iconCls="icon-back" plain="true" outline="true">主页</a>
            </div>
			<div class="m-right">
				<a href="javascript:void(0)" class="easyui-menubutton" data-options="iconCls:'icon-more',menu:'#mm',menuAlign:'right',hasDownArrow:false"></a>
			</div>
        </header>
		<div id="mm" class="easyui-menu" style="width:150px;">			
			<div class="menu-sep" style="font-size:110%"><b>我创建</b></div>
			<div onclick="doSearchMore('New','01')">已完成</div>
			<div onclick="doSearchMore('New','02')">未完成</div>
			<div class="menu-sep" style="font-size:110%"><b>我处理</b></div>
			<div onclick="doSearchMore('New','11')">已完成</div>			
			<div onclick="doSearchMore('New','12')">未完成</div>
			<div class="menu-sep" style="font-size:110%"><b></b></div>
			<div onclick="doSearchMore('New','21')">其他人完成的</div>	
		</div>
		
		
		<p id="idBtnStart" style="text-align:center;display:none;"><a href="#" onclick="doSearch()" class="easyui-linkbutton c1" style="width:80%">开始搜索</a></p>		
		
       
		<ul id="idList" class="m-list"> 
		</ul>
		
		
		<p style="text-align:center;">
		
		<a id="idBtnContinue" href="#" onclick="doSearch('Next')" class="easyui-linkbutton c6" style="width:80%;display:none;">
			<span id="idBtnShowMore">显示更多</span>
		</a><br>
		<a id="idBtnEnd" href="#" disabled  class="easyui-linkbutton c2" style="width:80%;display:none;">这里是底线了</a>
		
		</p>
		
		
    </div>
    <style scoped>
        #list .list-image{
            width: 32px;
            height: 32px;
            border: 0;
            margin-right: 5px;
            float: left;
        }
        #list .list-header{
            font-size: 16px;
            font-weight: bold;
        }
        #list .list-content{
            text-overflow: ellipsis;
            overflow: hidden;
        }
    </style>
	

<script>

$(document).ready(function(){

	//var Request = UrlGetRequest(); 
	//$('#idSearchClass').val(Request['Class']);
	//$('#idCurWXID').val(Request['CurWXID']);
	$('#idCurWXID').val('17665201558');
	$('#idSearchClass').val('01');
	//doOpen_checkUser('');
	doSearch('New');
}); 

//Ajax请求,
var numLine = 0;
function doSearch(strType){
	
	if(strType=="New"){
		delObj();
		numLine = 0;
		$("#idNumFrom").val("1");
	}
		
	numFrom = $('#idNumFrom').val();
	if(numFrom == ""){
		numFrom = "1";
	}

	sClass = $('#idSearchClass').val();
	//发送请求 
	var requestURL = "php/searchListByClass.php?Class="+sClass+"&CurWXID="+$('#idCurWXID').val()+"&From="+numFrom+"&";
	
	$.ajax({
		url:requestURL,
		type:'GET', dataType:'text', 		
		success:function(sText,textStatus,jqXHR){	
			ajaxLoadEnd();
			
			//alert(sText);
			jsonResp = JSON.parse(decodeURI(sText));
			
			if(jsonResp.errcode != "0" ||jsonResp.Num == 0){	
				$('#idMsgShow').html('没有记录');
				return;
			}
			
			numTotal = 1 * jsonResp.Num;
			$('#idMsgShow').html("共有 "+numTotal+" 条");
			
			numFrom = 1 * jsonResp.From;
			numShow = 1 * jsonResp.NumShow;
			numTo = numFrom + numShow;
			$('#idNumFrom').val(numFrom + numShow);
			
			if(numTo <= numTotal){
				document.getElementById("idBtnContinue").style.display="";
				document.getElementById("idBtnEnd").style.display="none";
				
				sTemp = '查看剩余'+(numTotal-numTo+1)+'条 / 共'+numTotal+'条记录';
				$('#idBtnShowMore').html(sTemp);
				
			}else{
				document.getElementById("idBtnContinue").style.display="none";
				document.getElementById("idBtnEnd").style.display="";
				$('#idBtnShowMore').html('查看更多记录');
				
				$("#idNumFrom").val("1");
			}
			//document.getElementById("idBtnStart").style.display="none";
			
			var arrline = jsonResp.List;
			//addObj();
			
			for(i=0;i<numShow;i++){
				addObj(arrline[i]);
			}
			
		return;				
		}		
	})
}					

//Ajax请求,
function doSearchMore(strType,sClass){
	
	$('#idSearchClass').val(sClass);
	doSearch(strType);
	
}					








</script>


</body>    
</html>
﻿